@{
    ViewData["Title"] = "POS";
}


@model AllBlue.Models.IndexViewModel


<div class="shadow-all-sides p-3 d-flex flex-column gap-3">

    <div class="d-flex justify-content-between">
        <div class="d-flex gap-4">
            <div class="d-flex gap-2 align-items-center">
                <i class="fs-6 bi-cart"></i> 
                Point Of Sale
            </div>
            <button class="bg-danger text-white px-4 rounded" id="openSearchCustomerModal" style="border: none">
                <i class="fs-6 bi-search"></i> 
                Customer
            </button>
            <button class="bg-primary text-white px-4 rounded" id="openReturnGallonModal" style="border: none">
                <i class="fs-6 bi-arrow-return-left"></i> 
                Return Gallon
            </button>
            <button class="bg-success text-white px-4 rounded" id="openAddCustomerModal" style="border: none">
                <i class="fs-6 bi-plus-circle"></i> 
                New Customer
            </button>
        </div>

        <div class="d-flex gap-3">
            <i class="fs-5 bi-arrow-clockwise"></i> 
            <i class="fs-5 bi-fullscreen"></i> 
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show w-100 m-0" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show w-100 m-0" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="d-flex flex-row justify-content-between">
        <div class="shadow-all-sides" style="width: 68%">

            <div class="d-flex flex-row" style="width: 100%;">

                <div class="d-flex flex-column justify-content-center align-items-center" style="width:70%">
                    <span class="fs-5 fw-bold">@ViewBag.CustomerName</span>
                    <span class="font-small">@ViewBag.CustomerAddress</span>
                </div>
                <div class="d-flex flex-column p-2 gap-2" style="width:30%">

                    <select class="form-select delivery-mode" id="select-service">
                        <option value="Deliver">Deliver</option>
                        <option value="Pickup">Pickup</option>
                    </select>

                    <select  class="form-select" id="select-user" asp-items="ViewBag.UserList">
                        <option value=""></option>
                    </select>

                </div>

            </div>

            <div class="d-flex flex-row p-2 gap-2">

                <div class="d-flex flex-column gap-2">
                    <button type="button" id="gallonBtn" class="p-2 rounded" style="border: none; background-color: black; color: white;">Gallon</button>
                    <button type="button" id="bottleBtn" class="p-2 rounded" style="border: none">Bottle</button>
                </div>
               
                <div id="gallonContainer">
                    <table class="table table-striped" style="width: 100%; table-layout: fixed;">
                        <thead class="table-dark">
                            <tr>
                                <th class="font-small text-center" style="width: 40px" scope="col">#</th>
                                <th class="font-small text-center" scope="col">ITEM</th>
                                <th class="font-small text-center" scope="col">PRICE</th>
                                <th class="font-small text-center" scope="col">CLIENT GAL</th>
                                <th class="font-small text-center" scope="col">WRS GAL</th>
                                <th class="font-small text-center" scope="col">FREE</th>
                                <th class="font-small text-center" scope="col">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model?.Items != null && Model.Items.Any())
                            {
                                @foreach (var item in Model.Items.Where(i => i.Item_Type == "Container")) 
                                {
                                    <tr>
                                        <th class="font-small text-center" scope="row">@item.Item_ID</th>
                                        <td class="font-small text-center">@item.Title</td>
                                        <td class="font-small text-center price-cell"></td>
                                        <td>
                                            <input 
                                                type="number" 
                                                class="form-control form-control-sm client-gal" 
                                                data-item-name="@item.Title"
                                                data-deliver="@item.Deliver"
                                                data-pickup="@item.Pickup" />
                                        </td>
                                        <td>
                                            <input type="number" 
                                                class="form-control form-control-sm wrs-gal"
                                                data-item-name="@item.Title"
                                                data-deliver="@item.Deliver"
                                                data-pickup="@item.Pickup" />
                                        </td>
                                        <td>
                                            <input type="number" 
                                                class="form-control form-control-sm free-gal"
                                                data-item-name="@item.Title"
                                                data-deliver="@item.Deliver"
                                                data-pickup="@item.Pickup"  />
                                        </td>
                                        <td class="font-small text-center total-cell"></td>
                                    </tr>
                                }
                            } else 
                            {
                            <tr>
                                <td colspan="8" class="text-center text-muted">No Item found.</td>
                            </tr>   
                            }
                                                
                        </tbody>
                    </table>
                </div>
        
                

                <div id="bottleContainer" style="display: none">
                    <table class="table table-striped" style="width: 100%; table-layout: fixed;">
                    <thead class="table-dark">
                        <tr>
                            <th class="font-small text-center" style="width: 40px" scope="col">#</th>
                            <th class="font-small text-center" scope="col">ITEM</th>
                            <th class="font-small text-center" scope="col">PRICE</th>
                            <th class="font-small text-center" scope="col">CLIENT GAL</th>
                            <th class="font-small text-center" scope="col">WRS GAL</th>
                            <th class="font-small text-center" scope="col">FREE</th>
                            <th class="font-small text-center" scope="col">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model?.Items != null && Model.Items.Any())
                        {
                            @foreach (var item in Model.Items.Where(i => i.Item_Type == "Bottle")) 
                            {
                                <tr>
                                    <th class="font-small text-center" scope="row">@item.Item_ID</th>
                                    <td class="font-small text-center">@item.Title</td>
                                    <td class="font-small text-center price-cell"></td>
                                    <td>
                                        <input 
                                                type="number" 
                                                class="form-control form-control-sm client-gal" 
                                                data-item-name="@item.Title"
                                                data-deliver="@item.Deliver"
                                                data-pickup="@item.Pickup" />
                                    </td>
                                    <td>
                                        <input type="number" 
                                            class="form-control form-control-sm wrs-gal"
                                            data-item-name="@item.Title"
                                            data-deliver="@item.Deliver"
                                            data-pickup="@item.Pickup" />
                                    </td>
                                    <td>
                                        <input type="number"
                                            class="form-control form-control-sm free-gal"
                                            data-item-name="@item.Title"
                                            data-deliver="@item.Deliver"
                                            data-pickup="@item.Pickup" />
                                    </td>
                                    <td class="font-small text-center total-cell"></td>
                                </tr>
                            }
                        } else 
                        {
                        <tr>
                            <td colspan="8" class="text-center text-muted">No Item found.</td>
                        </tr>   
                        }
                                             
                    </tbody>
                </table>
                </div>
                

                
                <script>
                    const gallonBtn = document.getElementById('gallonBtn');
                    const bottleBtn = document.getElementById('bottleBtn');

                    const gallonContainer = document.getElementById('gallonContainer');
                    const bottleContainer = document.getElementById('bottleContainer');

                    gallonBtn.addEventListener('click', () =>{
                        gallonContainer.style.display = "block";
                        bottleContainer.style.display = "none";

                        gallonBtn.style.backgroundColor = "black";
                        bottleBtn.style.backgroundColor = "";

                        gallonBtn.style.color = "white";
                        bottleBtn.style.color = "";
                    });


                    bottleBtn.addEventListener('click', () =>{
                        gallonContainer.style.display = "none";
                        bottleContainer.style.display = "block";

                        gallonBtn.style.backgroundColor = "";
                        bottleBtn.style.backgroundColor = "black";
                        
                        gallonBtn.style.color = "";
                        bottleBtn.style.color = "white";

                    });

                </script>
               
            </div>

        </div>

        <div class="d-flex flex-column align-items-center shadow-all-sides p-2 gap-2" style="width: 30%; min-height: 350px;">

            <div class="d-flex w-100 border-bottom pb-2">
                <span class="fw-bold w-100">Date</span>
                <input type="date" id="date" name="date" value="" class="font-extra-small form-control" />
            </div>

            <span class="">Order Item Summary</span>

            <table id="summaryTable" class="table table-striped"  style="width: 100%; table-layout: fixed;">
                <thead class="table-dark">
                    <tr>
                        <th class="font-extra-small text-center" scope="col">ITEM</th>
                        <th class="font-extra-small text-center" scope="col">QTY</th>
                        <th class="font-extra-small text-center" scope="col">Price</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="font-extra-small text-center">(Item name here)</td>
                        <td class="font-extra-small text-center">(qty)</td>
                        <td class="font-extra-small text-center">(price)</td>
                    </tr>
                    <tr>
                        <th class="font-extra-small text-center" scope="row">TOTAL</th>
                        <td class="font-extra-small text-center">(total qty)</td>
                        <td class="font-extra-small text-center">(total price)</td>
                    </tr>
                </tbody>
            </table>

            <div class="d-flex flex-row justify-content-between align-items-center mt-auto border-top border-bottom fw-bold" style="width: 80%;">
                <span>SUB TOTAL</span>
                <span id="subtotal" class="fs-4">(P 1,425.00)</span>
            </div>

            <button class="bg-success text-white p-2 rounded" 
                    id="openConfirmPaymentModal"
                    data-customer-id="@ViewBag.CustomerID"
                    data-user-id="@ViewBag.User_Account_ID"
                    style="border: none">
                <i class="font-small bi-send"></i> 
                Confirm Payment
            </button>

        </div>
    </div>


    <div class="d-flex flex-column align-items-center p-2 gap-2 shadow-all-sides">
        <div class="text-center p-2"> <i class="bi bi-clock-history"></i> Today's Previous Transaction</div>

        <table class="table table-striped" style="width: 100%; table-layout: fixed;">
            <thead class="table-dark">
                <tr>
                    <th class="font-small text-center" style="width: 40px" scope="col">#</th>
                    <th class="font-small text-center" scope="col">NAME</th>
                    <th class="font-small text-center" style="width: 400px;" scope="col">PRODUCT</th>
                    <th class="font-small text-center" scope="col">SERVICE STATUS</th>
                    <th class="font-small text-center" scope="col">DATE</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Orders != null && Model.Orders.Any())    
                {
                    @foreach (var order in Model.Orders)
                    {
                        <tr>
                            <th class="font-small text-center" scope="row">@order.OrderID</th>

                            <td class="font-small">
                                <div>
                                    <i class="bi bi-three-dots-vertical"></i>
                                    <span>@order.CustomerName</span>
                                </div>
                                <div>
                                    <i class="bi bi-three-dots-vertical"></i>
                                    <span class="font-extra-small">Ate Gina -Likod Pwesto</span>
                                </div>
                                <div>
                                    <i class="bi bi-three-dots-vertical"></i>
                                    <span class="font-extra-small">@order.CustomerAddress</span>
                                </div>
                            </td>

                            <td class="font-small text-center">
                                <table class="table table-striped" style="width: 100%; table-layout: fixed;">
                                    <thead class="thead-light">
                                        <tr>
                                            <th class="font-extra-small text-center" scope="col">ITEM</th>
                                            <th class="font-extra-small text-center" scope="col">Client</th>
                                            <th class="font-extra-small text-center" scope="col">WRS</th>
                                            <th class="font-extra-small text-center" scope="col">QTY</th>
                                            <th class="font-extra-small text-center" scope="col">FREE</th>
                                            <th class="font-extra-small text-center" scope="col">Price</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var product in order.Products)
                                        {
                                            <tr>
                                                <td class="font-extra-small text-center">@product.ItemName</td>
                                                <td class="font-extra-small text-center">@product.ClientGal</td>
                                                <td class="font-extra-small text-center">@product.WRSGal</td>
                                                <td class="font-extra-small text-center">@product.QTY</td>
                                                <td class="font-extra-small text-center">@product.FreeGal</td>
                                                <td class="font-extra-small text-center">@product.Price</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>

                            </td>

                            @{
                                string bgClass = order.Status switch
                                {
                                    "Unpaid" => "bg-danger",
                                    "Discount" => "bg-warning", // orange
                                    _ => "bg-success"  // default for Paid or others
                                };
                            }

                            <td class="align-middle text-center text-white">
                                <div class="font-extra-small bg-success p-2 rounded-pill" style="display: inline-block;">
                                    @order.Service
                                </div>
                                <div class="font-extra-small @bgClass p-2 rounded-pill" style="display: inline-block;">
                                    @order.Status
                                </div>
                            </td>

                            <td class="text-center align-middle">
                                <span class="font-small">@order.Date.ToString("MMMM dd, yyyy")</span>
                            </td>
                        </tr>
                    }
                } else {
                    <tr>
                        <td colspan="5" class="text-center text-muted">No Item found.</td>
                    </tr>
                }
            </tbody>
        </table>

        <nav aria-label="Pagination">
            <ul class="pagination">
                <li class="page-item @(ViewBag.Window == 1 ? "disabled" : "")">
                    <a class="page-link" 
                        asp-action="Index"
                        asp-route-page="@((ViewBag.StartPage - 5) > 0 ? ViewBag.StartPage - 5 : 1)"
                        asp-route-window="@(ViewBag.Window -1)">
                        Previous
                    </a>
                </li>


                @for (int i = ViewBag.StartPage; i <= ViewBag.Endpage; i++)
                {
                    <li class="page-item @(ViewBag.CurrentPage == i ? "actve" : "")">
                        <a class="page-link"
                            asp-action="Index"
                            asp-route-page="@i"
                            asp-route-window="@ViewBag.Window">
                            @i
                        </a>
                    </li>
                }

                <li class="page-item @(ViewBag.EndPage == ViewBag.TotalPages ? "disabled" : "")">
                    <a class="page-link" 
                        asp-action="Index"
                        asp-route-page="@((ViewBag.EndPage + 1) <= ViewBag.TotalPages ? ViewBag.EndPage + 1 : ViewBag.TotalPages)"
                        asp-route-window="@(ViewBag.Window + 1)">
                        Next
                    </a>
                </li>
            </ul>
        </nav>


    </div>

</div>


<div id="modalContainer"></div>
<script src="~/js/POS/addCustomer.js" asp-append-version="true"></script>
<script src="~/js/POS/returnGallon.js" asp-append-version="true"></script>
<script src="~/js/POS/searchCustomer.js" asp-append-version="true"></script>
<script src="~/js/POS/confirmPayment.js" asp-append-version="true"></script>
<script src="~/js/POS/posCalculation.js" asp-append-version="true"></script>
<script src="~/js/POS/setTodayDate.js" asp-append-version="true"></script>

